X={menus:{contextMenu:{menuName:"contextMenu",createOnMousePosition:!0,correctionType:0,listenerType:"contextmenu",toggleElement:null,recreateBehaviour:"recreate",changeBorder:!1,preventDefault:!0,enterAnimation:"fadeIn",exitAnimation:"fadeOut",exitAnimationTime:100,elementQuery:"#context_menu",getHTML:function(e=100,t=100){return""},closeCondition:function(e){return"context_menu"!=e.target.id}},activities:{menuName:"activities",listenerType:"click",toggleElement:document.querySelector("#activitiesMenuButton"),recreateBehaviour:"toggle",enterAnimation:"fadeIn",exitAnimation:"fadeOut",exitAnimationTime:200,elementQuery:"#activitiesMenuContainer",getHTML:function(){return`\n\t\t\t\t<div id='activitiesMenuContainer'>\n\t\t\t\t\t<div class='app_search'><search_icon></search_icon><input placeholder='Type to search' type='search'></div>\n\t\t\t\t\t<div class="search_results_container"></div>\n                    <div class="open_apps_preview_container"></div>\n                    <div class='favorites'>\n                    \n\t\t\t\t\t${Object.entries(apps).map((e=>{let t=e[0][0];return null!=e[1].icon?t=`<img src='${e[1].icon}'>`:null!=e[1].name&&(t=`<span>${e[1].name[0]}</span>`),`<button class='app' onclick="X.clearOpenMenus();processes.create('${e[0]}');" --data-tooltip="${e[1].name}" >${t}</button>`})).join("")}\n\t\t\t        </div>\n\t\t\t\t</div>`},closeCondition:function(e){return e.target==document.querySelector("#activitiesMenuContainer")},onCreate:function(){const e=systemMenuContainer.querySelector(".app_search > input");e.focus(),e.addEventListener("input",(t=>{const n=X.activities.requestResults(e.value),i=overlayContainer.querySelector(".favorites");isTextEmpty(e.value)?(overlayContainer.querySelector(".open_apps_preview_container").style.display="",i.classList.remove("hidden")):(overlayContainer.querySelector(".open_apps_preview_container").style.display="none",i.classList.add("hidden")),systemMenuContainer.querySelector(".search_results_container").innerHTML=n}));let t=0;systemMenuContainer.querySelector("#activitiesMenuContainer").addEventListener("keydown",(n=>{const i=systemMenuContainer.querySelector(".search_results_container");"Escape"!=n.key?(n.key.startsWith("Arrow")&&("ArrowRight"==n.key&&i.querySelectorAll(".app").length-1>t&&t++,"ArrowLeft"==n.key&&t>0&&t--,i.querySelectorAll(".app")[t].focus()),"ArrowRight ArrowLeft Tab Enter Escape".split(" ").includes(n.key)||(e.focus(),t=0,setTimeout((()=>{isDefined(i.querySelector(".app"))&&i.querySelector(".app").focus()}),5))):X.clearOpenMenus()})),appsContainer.style.display="none",isTextEmpty(appsContainer.innerHTML)||(overlayContainer.querySelector(".open_apps_preview_container").innerHTML=appsContainer.innerHTML,overlayContainer.querySelectorAll(".open_apps_preview_container > app_container").forEach((e=>{e.removeAttribute("onmousedown"),e.addEventListener("mousedown",(t=>{t.preventDefault(),t.stopPropagation(),X.clearOpenMenus(),processes.bringToTop(processes.pid[processes.getNumberPid(e.id)].getProcessElement())}))})))},onClose:function(){appsContainer.style.display="",overlayContainer.querySelector(".open_apps_preview_container").innerHTML=""}},notificationPanel:{menuName:"notificationPanel",listenerType:"click",toggleElement:document.querySelector("#topBarDateTime"),enterAnimation:"bottomFadeIn",exitAnimation:"bottomFadeOut",exitAnimationTime:200,elementQuery:"#notificationPanelContainer",parseNotificationsToHTML:function(){let e;if(e=X.notification.get()){let t="";return Object.values(e).forEach((e=>{t+=`<notification onclick="${e.clickAction}"><div class='notification_content'><img src='${e.iconPath}'><div class='notification_text_wrapper'><h1>${e.title}</h1><div class='description'>${e.description}</div></div></div>${e.type?"":`<x_icon onclick='X.notification.remove(${e.id}); this.parentElement.remove()'></x_icon>`}</notification>`})),t}},closeCondition:function(e){return"desktop"==X.screen.activeScreen||"loginScreen"==X.screen.activeScreen},getHTML:function(){switch(X.screen.activeScreen){case"desktop":const e={message:{display:"Message",value:"",type:"string",required:!0},time:{display:"Remind At",value:0,type:"number",required:!0}},t=`(async () => {\n                            reminder = await X.cta("form", { title: "Create Reminder", formData: ${JSON.stringify(e)}});\n                            command = "remind " + reminder.message.value + " -t " + reminder.time.value;\n                            system.cli.i(command, true)})();`;return`<div id='notificationPanelContainer'>\n                    <div class='notifications_container'>\n                        <div class='notification_wrapper'>${this.parseNotificationsToHTML()}</div>\n                            <div class='notification_footer'>\n                                <do_not_disrupt><span>Do not disturb</span><input id='doNotDisruptSwitch' ${system.global.doNotDisturb&&"checked"} type="checkbox"><label onclick="system.global.doNotDisturb = !this.parentElement.querySelector('#doNotDisruptSwitch').checked" for="doNotDisruptSwitch"></label></do_not_disrupt>\n                            <button class='button type-a' onclick='X.notification.removeAll(); document.querySelector("#notificationPanelContainer .notifications_container div.notification_wrapper").innerHTML = X.menus.notificationPanel.parseNotificationsToHTML()'>Clear</button>\n                            </div>\n                    </div>\n                        <calendar_container>\n                            <div class='calendar_wrapper'>\n                                ${X.calendar.getHTML()}\n                            </div>\n                            <button class='button type-a' onclick='${t}'>Add Reminder</button>\n                        </calendar_container>\n                    </div>`;case"loginScreen":return`<div id='notificationPanelContainer'>\n                        <calendar_container>\n                            <div class='calendar_wrapper'>\n                                ${X.calendar.getHTML()}\n                            </div>\n                        </calendar_container>\n                    </div>`}},closeCondition:function(e){return!elementIsInEventPath(e,document.querySelector("#notificationPanelContainer"))||tagIsInEventPath(e,"NOTIFICATION")&&"X_ICON"!=e.target.tagName}},statusArea:{menuName:"statusArea",listenerType:"click",toggleElement:document.querySelector("#statusAreaButton"),enterAnimation:"bottomFadeIn",exitAnimation:"bottomFadeOut",exitAnimationTime:200,elementQuery:"#statusAreaContainer",getHTML:function(){switch(X.screen.activeScreen){case"loginScreen":return`<div id='statusAreaContainer'>\n                        <li>\n                            <volume_icon></volume_icon>\n                            <input oninput='system.changeVolume(this.value)' id='volume_slider' min="0" max="100" value="${system.global.volume}" step="1" type="range">\n                        </li>\n                        <li>\n                            <brightness_icon></brightness_icon>\n                            <input oninput='system.changeBrightness(this.value)' id='brightness_slider' min="25" max="175" value="${system.global.brightness}" step="1" type="range">\n                        </li>\n                        <hr>\n                        <div class='dropdown_item' onclick='X.general.dropdown.toggle(this)'>\n                            <li><power_off_icon></power_off_icon><span>Power Off / Log Out</span><down_icon></down_icon></li>\n                            <dropdown>\n                                <li onclick='X.restart();'><span>Restart</span></li>\n                                <li onclick='X.shutdown();'><span>Power Off</span></li>\n                            </dropdown>\n                        </div>\n                    </div>`;case"lockScreen":return`<div class='lockscreen' id='statusAreaContainer'>\n                    <li>\n                        <volume_icon></volume_icon>\n                        <input oninput='system.changeVolume(this.value)' id='volume_slider' min="0" max="100" value="${system.global.volume}" step="1" type="range">\n                    </li>\n                    <li>\n                        <brightness_icon></brightness_icon>\n                        <input oninput='system.changeBrightness(this.value)' id='brightness_slider' min="25" max="175" value="${system.global.brightness}" step="1" type="range">\n                    </li>\n                    <hr>\n                    <div class='dropdown_item' onclick='X.general.dropdown.toggle(this)'>\n                        <li><power_off_icon></power_off_icon><span>Power Off / Log Out</span><down_icon></down_icon></li>\n                        <dropdown>\n                            <li onclick='X.logoff();'><span>Log Off</span></li>\n                            <hr>\n                            <li onclick='X.restart();'><span>Restart</span></li>\n                            <li onclick='X.shutdown();'><span>Power Off</span></li>\n                        </dropdown>\n                    </div>\n                        </div>`;case"desktop":return`<div id='statusAreaContainer'>\n                    <li>\n                    <volume_icon></volume_icon>\n                    <input oninput='system.changeVolume(this.value)' id='volume_slider' min="0" max="100" value="${system.global.volume}" step="1" type="range">\n                    </li>\n                    <li>\n                    <brightness_icon></brightness_icon>\n                    <input  oninput='system.changeBrightness(this.value)' id='brightness_slider' min="25" max="175" value="${system.global.brightness}" step="1" type="range">\n                    </li>\n                    <hr>\n                    <li><network_icon></network_icon><span>Connected</span></li>\n                    <hr>\n                    <li onclick="X.clearOpenMenus();processes.create('settings')"><settings_icon></settings_icon><span>Settings</span></li>\n                    <li onclick="X.screen.set('lockScreen')"><padlock_icon></padlock_icon><span>Lock</span></li>\n                    <div class='dropdown_item' onclick='X.general.dropdown.toggle(this)'>\n                    <li><power_off_icon></power_off_icon><span>Power Off / Log Out</span><down_icon></down_icon></li>\n                    <dropdown>\n                        <li onclick='X.restart();'><span>Restart</span></li>\n                        <li onclick='X.shutdown();'><span>Power Off</span></li>\n                        <hr>\n                        <li onclick='X.logout();'><span>Log Out</span></li>\n                    </dropdown>\n                    </div>\n                    </div>`}},closeCondition:function(e){return!elementIsInEventPath(e,document.querySelector("#statusAreaContainer"))}},taskSwitcher:{menuName:"taskSwitcher",createOnMousePosition:!1,recreateBehaviour:"static",changeBorder:!1,preventDefault:!1,enterAnimation:"fadeIn",exitAnimation:"fadeOut",exitAnimationTime:100,elementQuery:"#taskSwitcher",getHTML:function(){let e="";return Object.values(appsContainer.querySelectorAll("app_container")).map((t=>{let n=(t=processes.pid[processes.getNumberPid(t.id)]).appName,i=apps[n][0];null!=apps[n].icon?i=`<img src='${apps[n].icon}'>`:null!=apps[n].name&&(i=`<span>${apps[n].name[0]}</span>`),e=`<button class='app' data-appPid="${t.id}" onclick="X.clearOpenMenus()"><div class='iconWrapper'>${i}</div><span class='app_name'>${t.title}</span></button>`+e})).join(""),`<div id="taskSwitcher">${e}</div>`},onCreate:function(){setTimeout((()=>{document.querySelectorAll(this.elementQuery+"> .app")[1].focus()}),1);const e=processes.getPidObject().length;let t=1;document.querySelector(this.elementQuery).addEventListener("keydown",(n=>{"ArrowRight"!=n.key&&"Tab"!=n.key||++t&&e<=t&&(t=0),"ArrowLeft"==n.key&&--t&&t<0&&(t=e-1),setTimeout((()=>{document.querySelectorAll(this.elementQuery+" > .app")[t].focus()}),10)})),document.querySelector(this.elementQuery).addEventListener("keyup",(e=>{if(e.key.includes("Shift")){let e=document.querySelectorAll(this.elementQuery+" > .app")[t].getAttribute("data-appPid");processes.bringToTop(processes.pid[e].getProcessElement()),X.clearOpenMenus()}}))},createCondition:function(e){return!isDefined(document.body.getAttribute("onmousemove"))&&e.shiftKey&&"Tab"==e.key&&processes.getPidObject().length>1},closeCondition:function(e){return!0}}},activities:{indexedApps:[],requestResults:function(e){if(isTextEmpty(e))return"";e=e.toLowerCase();let t="";const n=["name","description"];return 0==this.indexedApps&&Object.entries(apps).forEach((e=>{const t=e[0],i=e[1];this.indexedApps.push([t,n.map((e=>isDefined(i[e])&&i[e].toLowerCase()+" "||"")).join("")])})),this.indexedApps.forEach((n=>{const i=n[0];if(n[1].includes(e)){let e=apps[i][0];null!=apps[i].icon?e=`<img src='${apps[i].icon}'>`:null!=apps[i].name&&(e=`<span>${apps[i].name[0]}</span>`),t+=`<button class='app' onclick="X.clearOpenMenus();processes.create('${i}');" --data-tooltip="${n[1].description}" ><div class='iconWrapper'>${e}</div><span class='app_name'>${apps[i].name}</span></button>`}})),t}},contextMenu:{add:function(e,t,n=!0){let i="";for(const e of t)if(isTextEmpty(e[0]))i+="<hr>";else if(Array.isArray(e[1])){i+=`<span class="context_sub_menu_header">${e[0]}</span>\n                    <div class='context_sub_menu'>`;for(const t of e[1])i+=`<span onclick="${t[1]}">${t[0]}</span>`;i+="</div>"}else i+=`<span onclick="${e[1]}">${e[0]}</span>`;contextMenuEventHandler=e=>{X.menus.contextMenu.getHTML=()=>`<div id='context_menu' class='fadeIn' style="top: ${e.clientY}px;left: ${e.clientX}px;">${i}</div>`,X.createMenu(X.menus.contextMenu,e.clientX,e.clientY,e)},n?X.addEventListener(e,"contextmenu",contextMenuEventHandler):e.addEventListener("contextmenu",contextMenuEventHandler)}},notification:{notifications:{},get:function(){return!isObjectEmpty(this.notifications)&&this.notifications},create:function(e="",t="",n="",i="",s=!1,o=!0){e=e||"Notification",t=t||"This is a default notification",i=i||"./assets/img/about.svg";let r="boolean"==typeof s&&s;n=n||"";let a=0==Object.entries(this.notifications).length?0:Number(Object.keys(this.notifications).sort().slice(-1))+1;if(o&&!system.global.doNotDisturb){const i=`<div onclick="${n}; this.style.display = 'none'" ><title>${e}</title><description>${t}</description></div>`;popupNotificationContainer.insertAdjacentHTML("afterbegin",i),popupNotificationContainer.children[0].style.transform="scale(1)",popupNotificationContainer.children[0].style.transition="all 0.2s linear",setTimeout((()=>{popupNotificationContainer.children[0].style.transform="scale(0.8)",popupNotificationContainer.children[0].style.opacity="0",setTimeout((()=>{popupNotificationContainer.children[0].remove()}),200)}),5e3)}this.notifications[a]={title:e,description:t,iconPath:i,type:r,clickAction:n,id:a}},remove:function(e){delete this.notifications[e]},removeAll:function(){for(x of Object.entries(X.notification.notifications))0==x[1].type&&delete X.notification.notifications[x[0]]}},calendar:{getHTML:function(){let e=`<div class='calendar'><month>${date.get("month>full date year")}</month><div class='calendar_content'>\n                    <week_days><div>Sun</div><div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div></week_days>\n                    <dates>`;return this.createCalendarArray(0,0,!0,!0).forEach((t=>{e+="<week>",e+=t.map((e=>`<day><span ${e.startsWith("-")?"class = 'not_current_months_date'":""} ${e.startsWith("&")?"class = 'current_date'":""}>${e.replace(/-|&/gm,"")||e}</span></day>`)).join(""),e+="</week>"})),e+"</div></div>"},createCalendarArray:function(e=0,t=0,n=!1,i=!1){let s=[];e=e||date.get("year"),t=t||date.get("month");const o=new Date(`${e}/${t}/1`);let r=new Date(o);r.setMonth(r.getMonth()+1),r=new Date(r-864e5);const a=new Date(o);a.setMonth(a.getMonth()-1);const c=new Date(o-864e5);let l=new Date(o-864e5*o.getDay()),u=range(l.getDate(),c.getDate()+1),d=range(o.getDate(),r.getDate()+1),m=range(1,30);if(n&&(u=u.map((e=>"-"+e)),m=m.map((e=>"-"+e))),i){const e=Number(date.get("date"));d[e-1]="&"+d[e-1]}let p=[].concat(u,d,m).slice(0,42).map((e=>1==(e=String(e)).length?"0"+e:e));for(let e=0;e<6;e++)s.push(p.splice(0,7));return s}},services:{clock:{onStart:function(){setTimeout((()=>{setInterval((()=>{this.update.updateElements.forEach((e=>{e.element.innerHTML=date.get(e.options)})),console.log("Time updated. Next one in: ",60-(new Date).getSeconds())}),1e3*(60-(new Date).getSeconds()))}),1e3*(60-(new Date).getSeconds()))},update:{updateElements:[],add:function(e,t){for(const t of this.updateElements)if(t.element==e)return!1;const n={element:e,options:t};this.updateElements.push(n),this.updateNow(e,t)},remove:function(e){for(const t of this.updateElements)if(t.element==e)return delete t,!0},updateNow:function(e,t){e.innerHTML=date.get(t)}}},volume:{update:function(){let e;const t=system.global.volume;e=t>66?"url('./assets/img/volume/high.svg')":t>33?"url('./assets/img/volume/medium.svg')":t>0?"url('./assets/img/volume/low.svg')":"url('./assets/img/volume/mute.svg')",document.querySelectorAll("volume_icon").forEach((t=>t.style.backgroundImage=e))}},keyboardShortcutHandler:{shortcutsUnparsed:[["Shift Tab",e=>{e.preventDefault(),X.createMenu(X.menus.taskSwitcher,null,null,e)}],["Shift q",e=>{e.preventDefault(),X.createMenu(X.menus.activities,null,null,e)}]],shortcuts:{},onStart:function(){this.shortcutsUnparsed.forEach((e=>{let t="",n=e[0].toLowerCase().split(" ");const i=n.pop(-1);n=n.join(" "),n.includes("ctrl")&&(t+="ctrl"),n.includes("shift")&&(t+="shift"),n.includes("alt")&&(t+="alt"),this.shortcuts[t+" "+i]=e[1]})),document.addEventListener("keydown",(e=>{if(!isDefined(e.key))return;let t="";const n=e.key.toLowerCase();e.ctrlKey&&"control"!=n&&(t+="ctrl"),e.shiftKey&&"shift"!=n&&(t+="shift"),e.altKey&&"alt"!=n&&(t+="alt"),t+=" "+n,isFunction(this.shortcuts[t])&&this.shortcuts[t](e)}))}}},general:{dropdown:{toggle:e=>{if(!isDefined(e))return!1;e.classList.toggle("open")}}},overlay:{create:function(e){X.clearOpenMenus(),overlayContainer.querySelector(".general").innerHTML+=`<div class='overlay'>${e}</div>`},remove:function(){overlayContainer.querySelectorAll(".general > div.overlay").forEach((e=>e.remove()))}},cta:function(e="button",t={}){return new Promise((async n=>{let i="",s=async()=>!1;switch(e){case"button":if(t.title=t.title||"cta title :)",t.message=t.message||"This is a generic cta message",t.buttons=t.buttons||[["OK",!0]],t.buttons==[]||"object"!=typeof t.buttons)return!1;"object"!=typeof t.buttons[0]&&(t.buttons=[...t.buttons]);let e=t.buttons.map((e=>`<input type='button' value='${e[0]}'>`)).join("");i=`\n                <cta>\n                    <h1>${t.title}</h1>\n                    <span>${t.message}</span>\n                    <div class='buttons_container'>${e}</div>\n                </cta>\n            `,s=async(e,t)=>{const n=document.querySelectorAll("cta > .buttons_container > input");for(const i in e.buttons)n[i].addEventListener("click",(async n=>{X.overlay.remove(),t(e.buttons[i][1])}))};break;case"form":let n="";if(isObjectEmpty(t.formData))return!1;for(const e of Object.entries(t.formData)){const t=e[0],i=e[1],s=typeof i.type;"number"!=s&&"string"!=s&&(i.type=""),n+=`<li><span>${i.display}</span><input id='${t}' type='${i.type}' value='${i.value}' ></li>`}i=`\n                <cta>\n                    <h1>${t.title}</h1>\n                    <form>${n}</form>\n                    <span class='error_message'></span>\n                    <div class='buttons_container'><input type='button' value='Cancel'><input type='button' value='Submit'></div>\n                </cta>\n            `,s=async(e,t)=>{const n=document.querySelectorAll("cta > form input");document.querySelector("cta > .buttons_container input[value='Submit']").addEventListener("click",(async i=>{for(const t of n){let n=e.formData[t.id];if(1==n.required&&""==t.value.trim())return document.querySelector("cta .error_message").innerHTML=`'${n.display}' Can't be empty`,!1;if(n.type!=typeof t.value&&isNaN(Number(t.value)))return document.querySelector("cta .error_message").innerHTML=`'${n.display}' must be a ${typeof n.type}`,!1;e.formData[t.id].value=t.value}X.overlay.remove(),t(e.formData)})),document.querySelector("cta > .buttons_container input[value='Cancel']").addEventListener("click",(async e=>{X.overlay.remove(),t(!1)}))}}X.overlay.create(i),s(t,n)}))},shutdown:async function(){let e=setTimeout((()=>{system.shutdown()}),1e4),t=X.cta("button",{title:"Power Off",message:"Received shutdown signal. Powering off in 10 seconds!",buttons:[["Cancel",!1],["Power Off",!0]]});await t&&system.shutdown(),clearTimeout(e)},logout:async function(){let e=setTimeout((()=>{system.logout()}),1e4),t=X.cta("button",{title:"Log Out",message:"You will be logged out in 10 seconds!",buttons:[["Cancel",!1],["Log Out",!0]]});await t&&system.logout(),clearTimeout(e)},restart:async function(){let e=setTimeout((()=>{system.restart()}),1e4),t=X.cta("button",{title:"Restart",message:"Received shutdown signal. Will restart in 10 seconds!",buttons:[["Cancel",!1],["Restart",!0]]});await t&&system.restart(),clearTimeout(e)},topBar:{hide:function(){topBar.style.display="none"},show:function(){topBar.style.display=""},setColor:function(e=""){topBar.style.backgroundColor=e,topBar.style.borderColor=e},showWrappers:function(e=!0,t=!0,n=!0){topBar.querySelector(".left_wrapper").style.visibility=e?"":"hidden",topBar.querySelector(".middle_wrapper").style.visibility=t?"":"hidden",topBar.querySelector(".right_wrapper").style.visibility=n?"":"hidden"}},cacheSession:function(){let e=system.accounts[system.activeUser].sessionStateCache;if(e.desktopHTML=mainContent.innerHTML,e.runningProcesses=processes.pid,e.notifications=X.notification.notifications,processes.pid={},X.notification.notifications={},activeEventListenersCache=system.accounts[system.activeUser].sessionStateCache.activeEventListeners,isDefined(activeEventListenersCache))for(const e of system.accounts[system.activeUser].sessionStateCache.activeEventListeners)e.element.removeEventListener(e.event,e.callback);else system.accounts[system.activeUser].sessionStateCache.activeEventListeners=[]},screen:{activeSubScreen:"",activeScreen:"",activeEventListeners:[],set:function(e){if(["loginScreen","lockScreen","desktop"].includes(e)){X.clearOpenMenus(),"desktop"==this.activeScreen&&"desktop"!=e&&X.cacheSession();for(const e of this.activeEventListeners)e.element.removeEventListener(e.type,e.callback);mainContent.innerHTML=screens[e].html,this.activeScreen=e,this.activeSubScreen="",this[e].init()}},setActiveSubScreen:function(e){mainContent.querySelectorAll(".login-lock_screen > *").forEach((e=>{e.style.display="none"})),mainContent.querySelectorAll(".ignore_hide").forEach((e=>e.style.display="")),mainContent.querySelector(e).style.display="",this.activeSubScreen=e},setToUserProfilePicture:function(e,t){if(isDefined(t))return e.style.backgroundImage=`url('${t}')`,void e.classList.add("custom_picture");e.style.backgroundImage="",e.classList.remove("custom_picture")},addEventListener:function(e,t,n){this.activeEventListeners.push({element:e,type:t,callback:n}),e.addEventListener(t,n)},loginUser:function(e,t){system.validatePassword(e,t)&&(system.activeUser=e,Object.entries(system.accounts[e].settings).forEach((e=>{let[t,n]=[e[0],e[1]];if(isObject(n)&&"cssVar"===n.type)root.style.setProperty("--"+n.variable,n.value)}))),X.screen.set("desktop")},loginScreen:{init:function(){X.topBar.showWrappers(0,1,1),X.topBar.setColor("transparent"),system.activeUser="",root.style="",mainContent.querySelectorAll(".back_button").forEach((e=>e.addEventListener("click",(e=>X.screen.loginScreen.showAccounts())))),mainContent.querySelector(".center_container > button").addEventListener("click",(e=>X.screen.loginScreen.showCustomLoginForm())),this.showAccounts()},showAccounts:function(){X.screen.setActiveSubScreen(".center_container"),mainContent.querySelector(".account_container").innerHTML="";let e=Object.values(system.accounts).map((e=>{if("root"!=e.username)return`\n                    <button class='account_content' onclick="X.screen.loginScreen.showLoginForm('${e.username}')">\n                        <user_icon ${isDefined(e.settings.profilePictureUrl)&&`style="background-image:url('${e.settings.profilePictureUrl}')" class="custom_picture"`||""}></user_icon>\n                        <span>${e.username}</span>\n                    </button>\n            `})).join("");mainContent.querySelector(".account_container").insertAdjacentHTML("afterbegin",e),mainContent.querySelector(".account_content").focus()},showLoginForm:function(e){if(isTextEmpty(system.accounts[e].encPassword))return void X.screen.loginUser(e,"");X.screen.setActiveSubScreen("#loginForm");const t=mainContent.querySelector("#loginForm");t.querySelector("#loginUserName").innerHTML=e,X.screen.setToUserProfilePicture(t.querySelector("user_icon"),system.accounts[e].settings.profilePictureUrl),t.reset();const n=t.querySelector("input");n.classList.remove("incorrectLogin"),n.focus(),t.addEventListener("submit",(i=>{i.preventDefault();let s=new FormData(t);system.validatePassword(e,s.get("password"))?X.screen.loginUser(e,s.get("password")):(n.classList.remove("incorrectLogin"),n.offsetWidth,n.classList.add("incorrectLogin"))}))},showCustomLoginForm:function(){X.screen.setActiveSubScreen("#customLoginForm");const e=mainContent.querySelector("#customLoginForm");e.reset(),e.querySelector("input").focus(),e.addEventListener("submit",(t=>{t.preventDefault();const n=new FormData(e).get("username");this.showLoginForm(n)}))}},lockScreen:{pauseElementChange:!1,init:function(){X.topBar.showWrappers(0,0,1),X.topBar.setColor("transparent"),this.time=mainContent.querySelector("#loginTime > time"),this.date=mainContent.querySelector("#loginTime > date"),X.services.clock.update.add(this.time,"time-s"),X.services.clock.update.add(this.date,"day>str month>str date"),this.loginForm=mainContent.querySelector("#loginForm"),this.loginTime=mainContent.querySelector("#loginTime");let e=this.loginForm,t=this.loginTime,n=e.querySelector("input");t.classList.add("selected"),isTextEmpty(system.accounts[system.activeUser].encPassword)&&(mainContent.querySelector(".switch_user_button").style.transform="scale(1)"),X.screen.setToUserProfilePicture(e.querySelector("user_icon"),system.accounts[system.activeUser].settings.profilePictureUrl),mainContent.querySelector(".login-lock_screen").addEventListener("mouseup",(e=>{t.classList.contains("selected")&&this.showLoginForm()})),X.screen.addEventListener(document,"keyup",(e=>{if(t.classList.contains("selected"))return this.showLoginForm();"Escape"==e.key&&this.showTime()})),mainContent.querySelector(".switch_user_button").addEventListener("click",(e=>X.screen.set("loginScreen"))),e.querySelector("#loginUserName").innerHTML=system.activeUser,e.reset(),n.classList.remove("incorrectLogin"),n.focus(),e.addEventListener("submit",(t=>{t.preventDefault();let i=new FormData(e);system.validatePassword(system.activeUser,i.get("password"))?X.screen.loginUser(system.activeUser,i.get("password")):(n.classList.remove("incorrectLogin"),n.offsetWidth,n.classList.add("incorrectLogin"))}))},enablePauseElementChange:function(){this.pauseElementChange=!0,setTimeout((()=>{this.pauseElementChange=!1}),500)},showTime:function(){this.pauseElementChange||(this.enablePauseElementChange(),this.loginTime.classList.add("selected"),this.loginForm.classList.remove("selected"),mainContent.querySelector(".switch_user_button").style.transform="scale(0)")},showLoginForm:function(){isTextEmpty(system.accounts[system.activeUser].encPassword)&&(setTimeout((()=>{"lockScreen"==X.screen.activeScreen&&X.screen.loginUser(system.accounts[system.activeUser],"")}),500),this.loginForm.style.display="none"),this.pauseElementChange||(this.enablePauseElementChange(),this.loginTime.classList.remove("selected"),this.loginForm.classList.add("selected"),mainContent.querySelector(".switch_user_button").style.transform="scale(1)",setTimeout((()=>{this.loginForm.querySelector("input").focus()}),100))}},desktop:{init:function(){if(X.topBar.showWrappers(1,1,1),X.topBar.setColor(""),!isObjectEmpty(system.accounts[system.activeUser].sessionStateCache)){let e=system.accounts[system.activeUser].sessionStateCache;mainContent.innerHTML=e.desktopHTML,processes.pid=e.runningProcesses,X.notification.notifications=e.notifications;for(const e of system.accounts[system.activeUser].sessionStateCache.activeEventListeners)e.element.addEventListener(e.event,e.callback);e={}}desktop=document.querySelector("#mainContent > #desktop"),popupNotificationContainer=document.querySelector("#mainContent > #popupNotificationsContainer"),appsContainer=document.querySelector("#mainContent > #appsContainer"),appList=document.querySelector("#mainContent > #appList"),X.contextMenu.add(desktop,[["Web Browser","processes.create('webbrowser');"],[""],["Terminal","processes.create('terminal')"],[""],["Settings","processes.create('settings')"]],!1)}}},initialize:function(){root=document.documentElement,linux=document.querySelector("#linuxRoot"),topBar=document.querySelector("#linuxRoot> #topBar"),mainContent=document.querySelector("#mainContent"),systemMenuContainer=document.querySelector("#overlayContainer > #systemOverlays #systemMenuContainer"),systemExitAnimationMenuContainer=document.querySelector("#overlayContainer > #systemOverlays #systemMenuAnimationContainer"),overlayContainer=document.querySelector("body > #overlayContainer"),X.screen.set("loginScreen"),X.services.clock.update.add(document.querySelector("#topBarDateTime"),"month>str date time-s"),X.notification.create("1 upcoming event","May 7th, 2022:<br />Hex90: Overflow @ Wonderville","processes.create('webbrowser');","./assets/img/icon.browser.transparent.png",!0,!1),Object.entries(X.services).forEach((e=>{let[t,n]=[e[0],e[1]];"function"==typeof n.onStart&&n.onStart()})),X.menus.openMenuClicked=!1,xObjSchema={createOnMousePosition:!1,listenerType:"click",toggleElement:null,recreateBehaviour:"toggle",changeBorder:!0,preventDefault:!1,getHTML:"",onCreate:"",closeCondition:"",enterAnimation:"",exitAnimation:"",elementQuery:""},Object.entries(X.menus).forEach((e=>{let[t,n]=[e[0],e[1]],i={};Object.assign(i,xObjSchema),Object.assign(i,n),isObject(n)&&isDefined(i.toggleElement)&&isFunction(i.getHTML)&&i.toggleElement.addEventListener(i.listenerType,(e=>{e.preventDefault(),X.createMenu(i,e.clientX,e.clientY,e)}))})),document.body.addEventListener("click",(()=>{if(X.menus.openMenuClicked)return X.menus.openMenuClicked=!1,!1;X.clearOpenMenus()})),console.log("X Initialized")},clearOpenMenus:function(e=!1){(0!=systemMenuContainer.childrenElementCount||e)&&(Object.values(systemMenuContainer.children).forEach((e=>{const t=e.getAttribute("data-menu-name");if(isDefined(X.menus[t])){const n=X.menus[t];isDefined(n.toggleElement)&&isDefined(n.toggleElement.classList)&&n.toggleElement.classList.remove("selected"),isFunction(n.onClose)&&n.onClose(),n.exitAnimation&&(systemExitAnimationMenuContainer.insertAdjacentElement("afterbegin",e),e.classList.add(n.exitAnimation),n.enterAnimation&&e.classList.remove(n.enterAnimation),setTimeout((()=>{systemExitAnimationMenuContainer.innerHTML=""}),n.exitAnimationTime||200))}})),systemMenuContainer.innerHTML="")},createMenu:function(e,t=0,n=0,i=null){if(!isFunction(e.getHTML))return;if(isDefined(systemMenuContainer.querySelector(`*[data-menu-name='${e.menuName}']`))||i.stopPropagation(),isDefined(systemMenuContainer.querySelector(`*[data-menu-name='${e.menuName}']`))){if("static"==e.recreateBehaviour)return;if("toggle"==e.recreateBehaviour)return void this.clearOpenMenus()}if(!(isFunction(e.createCondition)&&e.createCondition(i)||!isFunction(e.createCondition)))return;this.clearOpenMenus();const s=e.getHTML(t,n);systemMenuContainer.insertAdjacentHTML("beforeend",s);const o=systemMenuContainer.lastElementChild;if(o.setAttribute("data-menu-name",e.menuName),e.preventDefault&&i.preventDefault(),systemMenuContainer.childElementCount>0&&systemMenuContainer.lastElementChild.addEventListener("click",(t=>{(isFunction(e.closeCondition)&&!e.closeCondition(t)||!isFunction(e.closeCondition))&&(X.menus.openMenuClicked=!0)})),e.changeBorder&&e.toggleElement.classList.add("selected"),isDefined(i)&&isFunction(e.onCreate)&&e.onCreate(i),e.createOnMousePosition){const i=isDefined(e.correctionType)?e.correctionType:0;[t,n]=X.correctPosition(t,n,o.offsetWidth,o.offsetHeight,i),o.style.left=t+"px",o.style.top=n+"px"}""!=e.elementQuery&&""!=e.enterAnimation&&o.classList.add(e.enterAnimation)},correctPosition:function(e,t,n,i,s=0){const o=isDefined(appList)?appList.offsetHeight:0;switch(s){case 0:e=e>window.innerWidth-n?window.innerWidth-n:e,t=t>window.innerHeight-(i+o)?t-i:t;break;case 1:e=e>window.innerWidth-n?e-n:e,t=t>window.innerHeight-(i+o)?t-i:t}return[e,t]},addEventListener:function(e,t,n){!isDefined(system.accounts[system.activeUser].sessionStateCache.activeEventListeners)&&(system.accounts[system.activeUser].sessionStateCache.activeEventListeners=[]),system.accounts[system.activeUser].sessionStateCache.activeEventListeners.push({element:e,event:t,callback:n}),e.addEventListener(t,n)}};