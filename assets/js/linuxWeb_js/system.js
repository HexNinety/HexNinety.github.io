function parseDir(e,t=null,s=null){let n=isDefined(t)?t.currentDirectory:"/";return!isDefined(s)&&isDefined(e)&&(s=e["@s"]),isDefined(s)&&(s=s.endsWith("/")?s.slice(0,-1):s,n=isTextEmpty(s)?"/":".."==s?n.split("/").slice(0,-1).join("/"):s.startsWith("/")?s:n+(n.endsWith("/")?"":"/")+s),!n.startsWith("/")&&(n="/"+n),n}system={started:!1,activeUser:"",encPassword:"bf0dbd74174039131b667de9f31b5d8012baaf82011b934b2cc0e3bd53a02a1f",global:{volume:50,brightness:100,doNotDisturb:!1,css:{}},accounts:{root:{username:"root",privileged:!0,encPassword:"089a3d689f3e686106735966d4e74eff5422dcb09c23cb0f0b3544ed27162ce3",settings:{},sessionStateCache:{}},admin:{username:"admin",privileged:!1,encPassword:"089a3d689f3e686106735966d4e74eff5422dcb09c23cb0f0b3544ed27162ce3",settings:{background:{type:"cssVar",variable:"user-background",value:"url('https://cdn.pling.com/img//hive/content-pre1/155710-1.jpg')"},profilePictureUrl:"https://i.ytimg.com/vi/IVtf-51I0mM/maxresdefault.jpg"},sessionStateCache:{}},hex90:{username:"hex90",privileged:!1,encPassword:"bf0dbd74174039131b667de9f31b5d8012baaf82011b934b2cc0e3bd53a02a1f",settings:{background:{type:"cssVar",variable:"user-background",value:"url('/assets/img/wp7157989.jpg')"},profilePictureUrl:"/assets/img/bg.jpg"},sessionStateCache:{}},guest:{username:"guest",privileged:!1,encPassword:"",settings:{background:{type:"cssVar",variable:"user-background",value:"url('/assets/img/matrix-style-letters-falling-white-green.gif')"}},sessionStateCache:{}}},validatePassword:function(e,t){return!!isDefined(system.accounts[e])&&(!!isTextEmpty(system.accounts[e].encPassword)||sha256(btoa(t))==system.accounts[e].encPassword)},changeBrightness:function(e){this.global.brightness=e,document.querySelector("html").style.filter=`brightness(${system.global.brightness/100})`},changeVolume:function(e){this.global.volume=e,isDefined(X)&&X.services.volume.update()},startup:function(){if(this.started)return!1;this.started=!0,(async()=>{system.build=await(async()=>(await fetch("./build.ver")).text())()})(),isDefined(X)&&X.initialize()},cli:{i:function(e=!1,t=!1){if(!e||!t)return!1;let s=null,n=e.trim(),i=!1;n.includes(">")&&([n,i]=n.split(">"),n=n.trim(),i=parseDir(null,t,i.trim()));let r=(n+" ").split(" "),o=r.splice(0,1)[0].trim();if(0!=r.length&&(1!=r.length||0!==r[0].trim().length)){s={"@":[],$raw:n};let e="",t="";for(let n=0;n<r.length;n++){let i=r[n].trim();if(i.startsWith("-")&&i.length>1){if(!isTextEmpty(e)){this.appendToOptions(e,"",s);e=""}e=i.startsWith("--")&&i.length>2?"-"+i.replaceAll("-",""):i.replaceAll("-","")}else{if(isTextEmpty(e))s["@"].push(i);else{if(i.startsWith('"')){t+=i.slice(1)+" ";for(let e=n+1;e<r.length;e++){let s=r[e]+" ";if(s.startsWith("-")){n=e;break}if(s.includes('"')){t+=s.split('"')[0],n=e;break}t+=s}i=t,t=""}obj=this.appendToOptions(e,i,s)}e=""}}s["@s"]=s["@"].join(" ").trim()}console.log(s);try{const e=null!=system.cli.commands[o]?system.cli.commands[o].method(s,t):`${o}: command not found`;if(!i)return e;fileSystem.write(i,1,e,777)}catch(e){throw`${o}: ${e}`}},appendToOptions:function(e,t,s){if(e.startsWith("-"))s["-"+e]=t;else if(!isTextEmpty(e))for(const n of e)s["-"+n]=t;return s},commands:{help:{shortHelp:"Display helpful information about builtin commands",help:"Display helpful information about builtin commands\n\nUSAGE\n\n  help\n  help <command>",method:e=>{let t="";if(null==e)t="-----help-----\n",t+="For more information about a specific command type: help <command>\n\n",t+=Object.entries(system.cli.commands).map((e=>`${e[0].length>15&&e[0].slice(0,12)+"..."||e[0]}    ${e[0].length<8?"    ":""}${e[1].shortHelp??"*No short help available*"}\n`)).join("");else{let s=e["@"][0];null==system.cli.commands[s]||null==system.cli.commands[s].help?t=`No help for '${s}' try: help help`:(t=`----- ${s} help-----\n\n`,t+=system.cli.commands[s].help+"\n")}return t}},uname:{shortHelp:"Print operating system name",help:"Print operating system name",method:e=>"0x90 LTS (GNU/Linux 5.15-generic x86_64)"},whoami:{shortHelp:"display effective user id",help:"display effective user id",method:e=>system.activeUser},clear:{shortHelp:"clear the terminal screen",help:"clear the terminal screen",method:(e,t)=>{t.clear()}},echo:{shortHelp:"write arguments to the standard output",help:"write arguments to the standard output\n\nUSAGE\n  echo <message>\n   ----------------\n  echo Hello Word",method:e=>{if(null!=e){let t=e["@s"];return t=t.trim(),'"'==t[0]&&'"'==t.slice(-1)&&(t=t.slice(1,-1)),t}}},app:{shortHelp:"Starts an app",help:"Starts an app\n\nUSAGE\n  app <app name>\n  ----------------\n  app terminal\n  app notepad",method:e=>{if(!isDefined(e))return system.cli.commands.app.help;let t=e["@s"];if(null==apps[t])throw`${t}: No such app`;processes.create(t)}},shutdown:{shortHelp:"close down the system at a given time",help:"close down the system at a given time\n\nUSAGE\n  shutdown",method:()=>{system.shutdown()}},restart:{shortHelp:"Restarts the computer",help:"Restarts the computer\n\nUSAGE\n  restart",method:()=>{system.restart()}},logout:{shortHelp:"Logouts",help:"Logout of a login shell\n\nUSAGE\n  logout",method:()=>{system.logout()}},lock:{shortHelp:"Locks the screen",help:"Locks the screen\n\nUSAGE\n  lock",method:()=>{setTimeout((()=>{X.screen.set("lockScreen")}),100)}},exit:{shortHelp:"Exits the shell",help:"Exits the shell\n\nUSAGE\n  exit",method:(e,t)=>{processes.remove(t.elementId)}},kill:{shortHelp:"terminate or signal a process",help:"terminate or signal a process\n\nUSAGE\n  kill <process pid>\n  ----------------\n  kill 1",method:e=>{let t=e["@s"];if(isNaN(Number(t)))throw t+" - Must be a number";if(!isDefined(processes.pid[t]))throw t+" - No such process";processes.remove("pid"+t)}},killall:{shortHelp:"kill processes by name",help:"kill processes by name\n\nUSAGE\n  killall <process name>\n  ----------------\n  killall terminal\n  killall webrowser",method:e=>{const t=e["@s"],s=processes.getRunningInstanceList(t);if(!isValid(s)||0==s)throw t+" - No processes found";for(const e of s)processes.remove("pid"+e.id)}},remind:{shortHelp:"Create a reminder",help:"Create a reminder\n\nUSAGE\n  remind <message> -t <seconds>\n  ----------------\n  remind Sleep in the shed -t 180,\n  remind Go to bed -t 3600\n\nNOTES\n  remind is inspired by the leave(1) command that appeared in 3.0BSD.",method:e=>{const t=e["@s"],s=e["-t"];if(isNaN(Number(s)))throw" -t: must be a number";if(!isValid(t)||0==t.length)throw"message - Cannot be empty";setTimeout((()=>{X.notification.create("Reminder",t,"","",!1,!0)}),1e3*s)}},passwd:{shortHelp:"Change a password",help:"Changes a specified account's password\n\nUSAGE\n  passwd <username> -p <password>\n  passwd <username> -c\n  ----------------\n  passwd user1 -p 123 # Set user1's password to 123\n  passwd user1 -c     # Clears a users password",method:(e,t)=>{const s=e["@"][0];let n="";if(isTextEmpty(s))throw"Username not provided";if(!isDefined(system.accounts[s]))throw"That user does not exist";if(!isDefined(e["-c"])&&!isDefined(e["-p"]))throw"-c or -p required";if(isDefined(e["-c"])&&isDefined(e["-p"]))throw"You can't both clear and change a password";if(isDefined(e["-p"])&&isTextEmpty(e["-p"]))throw"-p: Can't be empty";if(n=e["-p"],!isDefined(e["-c"])||system.activeUser!==s)return system.activeUser===s?(system.accounts[s].encPassword=sha256(btoa(n)),"Password successfully changed"):"passwd: Permission denied";system.accounts[s].encPassword=""}},ls:{shortHelp:"list directory contents",help:"list directory contents\n\nUSAGE\n  ls <directory>\n  ----------------\n  ls\n  ls /home",method:(e,t)=>{const s=parseDir(e,t),n=fileSystem.getDir(s,!1,!0,0);let i=!1,r=`Contents of '${s}' :\n`;return isDefined(e)&&(i=!!isDefined(e["-l"])),Object.entries(n).forEach((e=>{if("\\0"!=e[0]){if(i){let t=1==fileSystem.getType(e[1])?"-":"d",s=fileSystem.getPermissions(e[1]);r+=`${t} ${s}`}r+=` ${e[0]}\n`}})),r.slice(0,-1)}},cd:{shortHelp:"Change the current directory",help:"Change the current directory\n\nUSAGE\n  cd <directory>\n  ----------------\n  cd\n  cd /home",method:(e,t)=>{t.setCurrentDirectory(parseDir(e,t))}},cat:{shortHelp:"concatenate and print files",help:"concatenate and print files\n\nUSAGE\n     cat <path/to/file>\n  ----------------\n  cat example.txt\n  cat /home/example.txt",method:(e,t)=>fileSystem.read(parseDir(e,t))},mkdir:{shortHelp:"make directories",help:"make directories\n\nUSAGE\n  mkdir <directory> or <path/to/directory>\n  ----------------\n  mkdir project\n  mkdir /var/www",method:(e,t)=>{fileSystem.write(parseDir(e,t),0,null,777)}},touch:{shortHelp:"change file access and modification times",help:"change file access and modification times\n\nUSAGE\n  touch <path/to/file>\n  ----------------\n  touch example.txt\n  touch /home/example.txt",method:(e,t)=>{const s=parseDir(e,t);fileSystem.write(s,1,"",777)}},write:{shortHelp:"Writes to a file",help:"Writes to a file\n\nUSAGE\n  write <text> -f <path/to/file>\n  ----------------\n  write Hello -f example.txt\n  write Hi! -f /home/example.txt",method:(e,t)=>{if(null==e||!isDefined(e["-f"]))throw"Path must be specified with -f!";{if(isTextEmpty(e["-f"]))throw"-f: Path can't be empty!";const s=e["-f"],n=e["@s"],i=parseDir(e,t,s);fileSystem.write(i,1,n,755)}}},rm:{shortHelp:"remove directory entries",help:"remove directory entries\n\nUSAGE\n  rm <path/to/file>\n  ----------------\n  rm example.txt",method:(e,t)=>{if(null==e)throw"Path must be specified";const s=parseDir(e,t,e["@s"]);fileSystem.removeFile(s,isDefined(e["-f"]))}},rmdir:{shortHelp:"removes directories",help:"removes directories\n\nUSAGE\n  rmdir <path/to/dir>\n  ----------------\n  rmdir var/example",method:(e,t)=>{if(null==e)throw"Path must be specified";const s=parseDir(e,t,e["@s"]);try{fileSystem.removeDir(s,isDefined(e["-f"]))}catch(e){if(e.startsWith("Error 10"))throw"That directory is not empty";throw e}}},top:{shortHelp:"display and update sorted information about processes",help:"display and update sorted information about processes\nUSAGE\n  top",method:function(e,t){t.initUpdate(this.update,e)},update:function(e,t,s=null){const n=processes.getPidObject();if(n){let e="PID    AppName\n";for(const t of Object.values(n))e+=`${t.id}    ${t.appName} \n`;return e}}},hex90:{shortHelp:"enter Hex90 tunnelling system",help:"enter Hex90 tunnelling system\nUsage\n    hex90",method:function(e,t){processes.create("hex90")}}}},shutdown:()=>page.changePage("./views/shutdown.html"),logout:async()=>{for(const e of jsSources)await page.loadJs(e);page.changePage("./views/X.html","system.startup();")},restart:()=>page.changePage("./views/shutdown.html","afterShutdown='restart'",!1)};